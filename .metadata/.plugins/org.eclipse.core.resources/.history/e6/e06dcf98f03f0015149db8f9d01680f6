package lab10.prob2.bugreporter;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.logging.Logger;

import lab10.prob2.classfinder.ClassFinder;




/**
 * This class scans the package lesson10.labs.prob2.javapackage for classes with
 * annotation @BugReport. It then generates a bug report bugreport.txt,
 * formatted like this:
 * 
 * Joe Smith reportedBy: classname: description: severity:
 * 
 * reportedBy: classname: description: severity:
 * 
 * Tom Jones reportedBy: classname: description: severity:
 * 
 * reportedBy: classname: description: severity:
 * 
 *
 */
public class BugReportGenerator {
	private static final Logger LOG = Logger.getLogger(BugReportGenerator.class
			.getName());
	private static final String PACKAGE_TO_SCAN = "lab10.prob2.javapackage";
	private static final String REPORT_NAME = "bug_report.txt";
	private static final String REPORTED_BY = "reportedBy: ";
	private static final String CLASS_NAME = "classname: ";
	private static final String DESCRIPTION = "description: ";
	private static final String SEVERITY = "severity: ";

	public void reportGenerator() {
		List<Class<?>> classes = ClassFinder.find(PACKAGE_TO_SCAN);
		// List<Annotation> anotations = classes.stream().flatMap(c ->
		// Arrays.asList(c.getAnnotations()).stream()).collect(Collectors.toList());
		Map<String, List<String>> map = new HashMap<>();
		List<String> values = new ArrayList<>();
		
		for (Class clazz : classes) {
			try {
				clazz = Class.forName(clazz.getName());
			} catch (ClassNotFoundException e1) {
				e1.printStackTrace();
			}
			BugReport br = (BugReport) clazz.getAnnotation(BugReport.class);
			String record = "\treportedBy: " + br.reportedBy() + "\n\tclassname: " + clazz.getName() + "\n\tdescription: " + br.description() + "\n\tsererity: " + br.severity() + "\n";
			if(map.containsKey(br.assignedTo())){
				map.get(br.assignedTo()).add(record);
			}else{
				List<String> newValues = new ArrayList<>();
				newValues.add(record);
				map.put(br.assignedTo(), newValues);
			}
//				System.out.println("\treportedBy: " + br.reportedBy());
//				System.out.println("\tclassname: " + clazz.getName());
//				System.out.println("\tdescription: " + br.description());
//				System.out.println("\tsererity: " + br.severity());
			}
		for(String name : map.keySet()){
			System.out.println(name);
			System.out.println(map.get(name));
		}

		}


	}

}
